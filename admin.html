<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Elite Terminal - Absolute Command</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script>
    tailwind.config = {
      theme: { extend: { colors: { elite: { bg: '#020617', blue: '#2563eb', red: '#ef4444', yellow: '#fbbf24' } } } }
    }
  </script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@500;700;900&display=swap');
    body { font-family: 'Space Grotesk', sans-serif; background-color: #020617; color: white; margin: 0; overflow-x: hidden; }
    .glass { background: rgba(3, 8, 22, 0.9); backdrop-filter: blur(12px); border: 1px solid rgba(37, 99, 235, 0.2); }
    .tab-active { border-bottom: 4px solid #2563eb; color: #2563eb; }
    .live-glow { box-shadow: 0 0 15px rgba(239, 68, 68, 0.3); }
    input, select { color: white; }
  </style>

  <script>
    // === 1. SYSTEM CONFIGURATION ===
    const supabaseUrl = 'https://your-project.supabase.co'; 
    const supabaseAnonKey = 'your-anon-key';
    const _supabase = supabase.createClient(supabaseUrl, supabaseAnonKey);

    const ADMIN_PASS = "elite2026";
    let leagueId = null;
    let currentMatchId = null;

    // === 2. CENTERED MODAL SYSTEM (Per Instruction) ===
    function openModal(title, msg, type = 'alert', callback = null) {
      const modal = document.getElementById('globalModal');
      const input = document.getElementById('modalInput');
      document.getElementById('modalTitle').innerText = title;
      document.getElementById('modalMsg').innerText = msg;
      
      input.classList.toggle('hidden', type !== 'prompt');
      input.value = "";
      
      modal.classList.remove('hidden');
      modal.classList.add('flex');

      document.getElementById('modalConfirm').onclick = () => {
        const val = input.value;
        closeModal();
        if (callback) callback(type === 'prompt' ? val : true);
      };
    }

    function closeModal() {
      document.getElementById('globalModal').classList.add('hidden');
      document.getElementById('globalModal').classList.remove('flex');
    }

    // === 3. CORE INITIALIZATION ===
    async function init() {
      // Access Control via Centered Modal
      openModal("Security Clearance", "Enter Admin Access Code", "prompt", async (pass) => {
        if (pass !== ADMIN_PASS) {
          window.location.reload();
        } else {
          // Sync League Data
          let { data } = await _supabase.from('leagues').select('id').eq('name', 'Elite League').single();
          if (!data) {
            const { data: nL } = await _supabase.from('leagues').insert({ name: 'Elite League' }).select().single();
            leagueId = nL.id;
          } else { leagueId = data.id; }
          
          refreshAll();
          setInterval(refreshAll, 5000); // Constant Sync
        }
      });
    }

    async function refreshAll() {
      loadTeams();
      loadFixtures();
      loadLive();
    }

    // === 4. NAVIGATION ===
    function switchTab(tabId) {
      document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
      document.getElementById(`tab-${tabId}`).classList.remove('hidden');
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('tab-active'));
      event.currentTarget.classList.add('tab-active');
    }

    // === 5. TEAM MANAGEMENT ===
    async function loadTeams() {
      const { data: teams } = await _supabase.from('teams').select('*').eq('league_id', leagueId).order('name');
      const list = document.getElementById('teamsList'), h = document.getElementById('hSelect'), a = document.getElementById('aSelect');
      list.innerHTML = ""; h.innerHTML = a.innerHTML = '<option value="">SELECT UNIT</option>';
      teams?.forEach(t => {
        list.innerHTML += `<div class="glass p-4 rounded-xl border-l-4 border-blue-500 font-bold uppercase text-xs italic">${t.name}</div>`;
        const opt = `<option value="${t.id}">${t.name}</option>`;
        h.innerHTML += opt; a.innerHTML += opt;
      });
    }

    async function addTeam() {
      const name = document.getElementById('teamNameInput').value;
      if (!name) return;
      await _supabase.from('teams').insert({ league_id: leagueId, name });
      document.getElementById('teamNameInput').value = "";
      loadTeams();
    }

    // === 6. FIXTURE DEPLOYMENT ===
    async function createFixture() {
      const h = document.getElementById('hSelect').value, a = document.getElementById('aSelect').value, d = document.getElementById('mDate').value;
      if (!h || !a || !d) return openModal("Error", "All deployment fields required.");
      await _supabase.from('matches').insert({ league_id: leagueId, home_team_id: h, away_team_id: a, date: d, status: 'scheduled' });
      openModal("Confirmed", "Fixture successfully deployed.");
      refreshAll();
    }

    async function loadFixtures() {
      const { data } = await _supabase.from('matches').select('*, home:teams!home_team_id(name), away:teams!away_team_id(name)').eq('status', 'scheduled');
      const container = document.getElementById('fixtureList');
      container.innerHTML = "";
      data?.forEach(m => {
        container.innerHTML += `
          <div class="glass p-5 rounded-2xl flex justify-between items-center mb-3">
            <p class="font-black italic uppercase text-sm">${m.home.name} VS ${m.away.name}</p>
            <button onclick="activateMatch('${m.id}')" class="bg-blue-600 px-5 py-2 rounded-lg font-black text-[10px] uppercase">Activate</button>
          </div>`;
      });
    }

    async function activateMatch(id) {
      await _supabase.from('matches').update({ status: 'live' }).eq('id', id);
      switchTab('live');
      refreshAll();
    }

    // === 7. LIVE FEED & COMMAND PANEL ===
    async function loadLive() {
      const { data } = await _supabase.from('matches').select('*, home:teams!home_team_id(name), away:teams!away_team_id(name)').eq('status', 'live');
      const container = document.getElementById('liveList');
      container.innerHTML = data?.length ? "" : "<p class='text-center opacity-30 py-20'>WAITING FOR TRANSMISSION...</p>";
      data?.forEach(m => {
        container.innerHTML += `
          <div class="glass p-8 rounded-[3rem] text-center border-red-500/30 border-2 live-glow">
            <p class="text-[10px] text-red-500 font-black animate-pulse mb-2">LIVE TRANSMISSION</p>
            <p class="text-2xl font-black uppercase italic mb-4 tracking-tighter">${m.home.name} vs ${m.away.name}</p>
            <p class="text-7xl font-black mb-8 text-blue-500">${m.home_score} - ${m.away_score}</p>
            <button onclick="openPanel('${m.id}', '${m.home.name}', '${m.away.name}', ${m.home_score}, ${m.away_score})" class="bg-white text-black px-10 py-4 rounded-2xl font-black text-xs uppercase hover:bg-blue-600 hover:text-white transition-all">Launch Control</button>
          </div>`;
      });
    }

    function openPanel(id, h, a, hs, as) {
      currentMatchId = id;
      document.getElementById('commandPanel').classList.remove('hidden');
      document.getElementById('pTitle').innerText = `${h} VS ${a}`;
      document.getElementById('pScore').innerText = `${hs} - ${as}`;
      window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
    }

    async function updateScore(side) {
      const { data } = await _supabase.from('matches').select('home_score, away_score').eq('id', currentMatchId).single();
      const up = side === 'h' ? { home_score: data.home_score + 1 } : { away_score: data.away_score + 1 };
      await _supabase.from('matches').update(up).eq('id', currentMatchId);
      refreshAll();
    }

    async function issueCard(color) {
      openModal(`${color.toUpperCase()} CARD`, "Enter Player Name/Number:", "prompt", async (pName) => {
        if (!pName) return;
        await _supabase.from('events').insert({ match_id: currentMatchId, type: color + '_card', player_name: pName });
        openModal("Recorded", `${color.toUpperCase()} card assigned to ${pName}`);
      });
    }

    async function setStatus(s) {
      openModal("System Update", `Confirm status change to: ${s.toUpperCase()}?`, "alert", async () => {
        await _supabase.from('matches').update({ status: s }).eq('id', currentMatchId);
        if (s === 'finished') document.getElementById('commandPanel').classList.add('hidden');
        refreshAll();
      });
    }

    window.onload = init;
  </script>
</head>
<body class="p-6 md:p-12">

  <div id="globalModal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-6 bg-black/90 backdrop-blur-lg">
    <div class="glass w-full max-w-sm p-12 rounded-[3.5rem] text-center shadow-2xl border-blue-600/50">
      <h3 id="modalTitle" class="text-3xl font-black italic uppercase text-blue-500 mb-2"></h3>
      <p id="modalMsg" class="text-gray-400 font-bold mb-8 text-xs uppercase tracking-widest"></p>
      <input id="modalInput" type="text" placeholder="IDENTITY..." class="hidden w-full bg-white/5 border border-white/10 rounded-xl px-5 py-5 mb-8 text-center font-black uppercase outline-none focus:border-blue-500"/>
      <div class="flex gap-4">
        <button id="modalConfirm" class="flex-1 bg-blue-600 py-5 rounded-2xl font-black uppercase text-[10px] tracking-tighter">Confirm</button>
        <button onclick="closeModal()" class="flex-1 bg-white/5 py-5 rounded-2xl font-black uppercase text-[10px] tracking-tighter">Cancel</button>
      </div>
    </div>
  </div>

  <div class="max-w-6xl mx-auto">
    <header class="flex flex-col md:flex-row justify-between items-center mb-20 gap-10">
      <div class="flex items-center gap-4">
        <div class="w-2 h-14 bg-blue-600 rounded-full"></div>
        <h1 class="text-6xl font-black italic uppercase tracking-tighter">Elite Terminal</h1>
      </div>
      <nav class="flex gap-2 bg-white/5 p-2 rounded-3xl border border-white/10">
        <button onclick="switchTab('units')" class="tab-btn tab-active px-8 py-3 rounded-2xl font-black uppercase text-[11px] tracking-widest">Units</button>
        <button onclick="switchTab('fixtures')" class="tab-btn px-8 py-3 rounded-2xl font-black uppercase text-[11px] tracking-widest">Fixtures</button>
        <button onclick="switchTab('live')" class="tab-btn px-8 py-3 rounded-2xl font-black uppercase text-[11px] tracking-widest text-red-500">Live Feed</button>
      </nav>
    </header>

    <section id="tab-units" class="tab-content">
      <div class="grid md:grid-cols-3 gap-12">
        <div class="glass p-10 rounded-[3rem] h-fit">
          <h2 class="text-xl font-black uppercase italic mb-8">Register Unit</h2>
          <input id="teamNameInput" placeholder="UNIT NAME" class="w-full bg-white/5 border border-white/10 rounded-2xl px-6 py-5 mb-6 font-black uppercase outline-none focus:border-blue-500"/>
          <button onclick="addTeam()" class="w-full bg-blue-600 py-5 rounded-2xl font-black uppercase text-xs">Deploy to Roster</button>
        </div>
        <div id="teamsList" class="md:col-span-2 grid grid-cols-2 lg:grid-cols-3 gap-6"></div>
      </div>
    </section>

    <section id="tab-fixtures" class="tab-content hidden">
      <div class="grid md:grid-cols-3 gap-12">
        <div class="glass p-10 rounded-[3rem] h-fit space-y-5">
          <h2 class="text-xl font-black uppercase italic mb-4">Initialize Fixture</h2>
          <select id="hSelect" class="w-full bg-elite-bg border border-white/10 rounded-2xl p-5 font-black uppercase outline-none"></select>
          <select id="aSelect" class="w-full bg-elite-bg border border-white/10 rounded-2xl p-5 font-black uppercase outline-none"></select>
          <input type="datetime-local" id="mDate" class="w-full bg-elite-bg border border-white/10 rounded-2xl p-5 font-black uppercase text-xs outline-none"/>
          <button onclick="createFixture()" class="w-full bg-cyan-600 py-5 rounded-2xl font-black uppercase text-xs">Commit Match</button>
        </div>
        <div id="fixtureList" class="md:col-span-2"></div>
      </div>
    </section>

    <section id="tab-live" class="tab-content hidden">
      <div id="liveList" class="grid md:grid-cols-2 gap-10 mb-20"></div>
      
      <div id="commandPanel" class="hidden glass p-12 rounded-[5rem] text-center border-t-8 border-blue-600 shadow-2xl">
        <h3 id="pTitle" class="text-2xl font-black italic uppercase text-gray-500 mb-6 tracking-tighter"></h3>
        <div id="pScore" class="text-[12rem] font-black leading-none mb-14 text-blue-500 tracking-tighter">0 - 0</div>
        
        <div class="grid grid-cols-2 gap-8 mb-10">
          <button onclick="updateScore('h')" class="bg-green-600 py-10 rounded-[2.5rem] font-black uppercase text-3xl hover:scale-105 transition-all">Goal Home</button>
          <button onclick="updateScore('a')" class="bg-green-600 py-10 rounded-[2.5rem] font-black uppercase text-3xl hover:scale-105 transition-all">Goal Away</button>
        </div>
        
        <div class="grid grid-cols-2 gap-8 mb-12">
          <button onclick="issueCard('yellow')" class="bg-elite-yellow text-black py-6 rounded-2xl font-black uppercase text-xs tracking-widest italic">Issue Yellow Card</button>
          <button onclick="issueCard('red')" class="bg-elite-red text-white py-6 rounded-2xl font-black uppercase text-xs tracking-widest italic">Issue Red Card</button>
        </div>

        <div class="flex flex-col md:flex-row gap-6">
          <button onclick="setStatus('paused')" class="flex-1 bg-gray-800 py-6 rounded-2xl font-black uppercase text-[10px] tracking-widest italic opacity-50 hover:opacity-100 transition-all">Pause Feed</button>
          <button onclick="setStatus('finished')" class="flex-1 bg-red-600 py-6 rounded-2xl font-black uppercase text-[10px] tracking-widest italic shadow-lg shadow-red-600/30">End Transmission (FT)</button>
        </div>
      </div>
    </section>
  </div>
</body>
</html>
